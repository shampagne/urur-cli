# Implementation Plan

- [x] 1. テスト基盤とモックセットアップ
- [x] 1.1 submitコマンドのテストファイルを作成し、依存モジュールのモックを構成する
  - auth, supabase, @inquirer/prompts, ora のモックを login.test.ts のパターンに合わせて設定する
  - console.log のスパイと process.exitCode のリセットを beforeEach/afterEach で管理する
  - _Requirements: 1.1, 1.2, 1.3_

- [x] 2. 認証チェックの実装
- [x] 2.1 未認証時のテストとエラーハンドリングを実装する
  - 認証情報が存在しない場合に「ログインが必要です」メッセージを表示するテストを書く
  - 認証情報を読み込んでSupabaseセッションを設定するフローを実装する
  - 認証情報が null の場合にエラーメッセージを表示し exitCode 1 で終了する
  - _Requirements: 1.1, 1.2_

- [x] 2.2 セッション無効時のテストとエラーハンドリングを実装する
  - セッション設定またはユーザー取得が失敗した場合のテストを書く
  - getUser() でセッション有効性を検証し、失敗時にエラーメッセージを表示する
  - 再ログインを促すメッセージを含める
  - _Requirements: 1.3_

- [x] 3. 入力収集の実装
- [x] 3.1 対話モード判定ロジックを実装する
  - `-i` フラグ指定時、name/url 未指定時にそれぞれ対話モードと判定するテストを書く
  - name と url が両方指定されている場合は非対話モードと判定するテストを書く
  - 判定関数を実装する
  - _Requirements: 2.2, 3.1_

- [x] 3.2 (P) 対話プロンプトでのデータ収集を実装する
  - 対話プロンプトでサービス名、URL、タグライン、説明、ロゴURLを順に入力させるテストを書く
  - 各プロンプトに即時バリデーションコールバックを設定する（サービス名とURLは必須、他は任意）
  - 空入力時に再入力を促す動作を検証する
  - _Requirements: 2.1, 2.3_

- [x] 3.3 (P) CLIオプションからのデータ構築を実装する
  - オプション指定時に対話プロンプトをスキップし、指定値からフォームデータを構築するテストを書く
  - オプショナルフィールド（tagline, description, logoUrl）が含まれることを検証する
  - _Requirements: 3.1, 3.2_

- [x] 4. バリデーションとエラー表示の実装
- [x] 4.1 CLIオプションモードでのバリデーションを実装する
  - CLIオプションモードで入力データを validateAll() で一括検証するテストを書く
  - バリデーションエラーがある場合に各フィールドのエラーメッセージを一覧表示するテストを書く
  - エラー表示関数を実装し、exitCode 1 で終了する
  - バリデーション通過時のみ後続処理に進むことを検証する
  - _Requirements: 4.1, 4.2, 4.3_

- [x] 5. 投稿前確認と投稿処理の実装
- [x] 5.1 投稿前の確認フローを実装する
  - バリデーション成功後にサマリーを表示し確認プロンプトを出すテストを書く
  - ユーザーがキャンセルした場合にキャンセルメッセージを表示して正常終了するテストを書く
  - サマリー表示関数と確認プロンプトを実装する
  - _Requirements: 6.1, 6.2_

- [x] 5.2 Supabaseへのサービス投稿を実装する
  - 確認後に services テーブルへ INSERT し、成功メッセージを表示するテストを書く
  - INSERT 失敗時にエラーメッセージを表示し exitCode 1 で終了するテストを書く
  - 投稿処理中にスピナーを表示することを検証する
  - user_id を getUser() の結果から取得してINSERTデータに含める
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [x] 6. 統合テストと動作確認
- [x] 6.1 エンドツーエンドのフロー統合テストを実装する
  - CLIオプション指定 → バリデーション → 確認 → INSERT 成功の完全フローテストを書く
  - 対話モード → 入力 → 確認 → INSERT 成功の完全フローテストを書く
  - 各テストが通過することを確認する
  - _Requirements: 1.1, 2.1, 3.1, 4.1, 5.1, 6.1_
